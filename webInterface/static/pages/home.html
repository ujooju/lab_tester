<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–∞–±–ª–∏—Ü–∞ –∏–∑ JSON</title>
    <style>
        table {
            border-collapse: collapse;
            width: 60%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #999;
            padding: 8px 12px;
            text-align: left;
        }
        th {
            background: #eee;
        }
    </style>
</head>
<body>

<h2>–î–∞–Ω–Ω—ã–µ –∏–∑ API</h2>
<h2><a href="/logout">logout</a></h2>
<table id="data-table"></table>

<script>
// –ü—Ä–∏–º–µ—Ä API ‚Äî –º–æ–∂–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–π URL
const API_URL_CUR_TASK = "/api/task-forks";

async function loadTable() {
    const response = await fetch(API_URL_CUR_TASK);
    const data = await response.json();

    const table = document.getElementById("data-table");

    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –∫–ª—é—á–µ–π –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç–∞–±–ª–∏—Ü—ã
    const headers = Object.keys(data[0]);

    // –°–æ–∑–¥–∞—ë–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
    const headerRow = document.createElement("tr");
    headers.forEach(key => {
        if (key.toLowerCase() === "url") {}
        else {
            const th = document.createElement("th");
            th.textContent = key;
            headerRow.appendChild(th);
        }
    });
    table.appendChild(headerRow);

    // –°—Ç—Ä–æ–∏–º —Å—Ç—Ä–æ–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏
    data.forEach(item => {
        const row = document.createElement("tr");
        headers.forEach(key => {
            const td = document.createElement("td");

            // üëâ –ï—Å–ª–∏ –∫–ª—é—á url ‚Äî —Å–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É
            if (key.toLowerCase() === "name" && item[key]) {
                const td = document.createElement("td");
                const a = document.createElement("a");
                a.href = item["url"];
                a.textContent = item[key];
                a.target = "_blank";
                td.appendChild(a);
                row.appendChild(td);
            } 
            else if (key.toLowerCase() === "url") {
            }
            else if (key.toLowerCase() === "test_url" && item[key]) {
                const td = document.createElement("td");
                const a = document.createElement("a");
                a.href = item[key];
                a.textContent = "start test";
                a.target = "_blank";
                td.appendChild(a);
                row.appendChild(td);
            }
            else {
                const td = document.createElement("td");
                td.textContent = 
                    typeof item[key] === "object" ? JSON.stringify(item[key]) : item[key];
                row.appendChild(td);
            }

            
        });
        table.appendChild(row);
    });
}

loadTable();
</script>

</body>
</html>